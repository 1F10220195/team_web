<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ホーム</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="simple-design">
        <h1>ようこそ！ログインしました。</h1>
        <div>
            <input type="text" id="userMessage" placeholder="質問を入力してください...">
            <button id="Button">送信</button>
            <!-- レスポンス表示エリア -->
            <div id="conversationArea">
                <!-- 会話履歴をここに表示 -->
            </div>
        </div>
        <p><a href="/health">健康管理ページに移動</a></p>
        <p><a href="/advice">栄養素アドバイス（仮）に移動</a></p>
        <p><a href="/logout">ログアウト</a></p>
    </div>
    <script>
        const conversationHistory = []; // 会話履歴を保存する配列
        const conversationArea = document.getElementById("conversationArea");
        
        document.getElementById("Button").addEventListener("click", async () => {
            const userMessage = document.getElementById("userMessage").value;
            if (!userMessage) return; // 空の入力は無視
            
            // ユーザーの入力を履歴に追加
            conversationHistory.push({ sender: "ユーザー", message: userMessage });
            updateConversationArea();
            
            // サーバーにリクエストを送信
            const response = await fetch("/analyze", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ word_input: userMessage })
            });
            
            // 応答を履歴に追加
            const data = await response.json();
            conversationHistory.push({ sender: "AI", message: data.result_2 });
            updateConversationArea();
            
            // 入力欄をクリア
            document.getElementById("userMessage").value = "";
        });
        
        function updateConversationArea() {
            // 会話履歴をHTMLに反映
            conversationArea.innerHTML = conversationHistory
                .map(entry => `<p><strong>${entry.sender}:</strong> ${entry.message}</p>`)
                .join("");
        }
    </script>
</body>
</html>
